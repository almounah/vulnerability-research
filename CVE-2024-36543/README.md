# CVE-2024-36543: Broken Authentication in Strimzi Operator

The Lack of Authentication in the Kafka Connect REST API in the STRIMZI Project in versions equals or below 0.41.0 allows an attacker to deny the service for Kafka Mirroring, potentially mirror the topics' content to his Kafka cluster via a malicious connector (bypassing Kafka ACL if it exists), and potentially steal Kafka SASL credentials, by querying the MirrorMaker Kafka REST API.

An attacker must be able to query the Pod that exposes the Kafka Connect Rest API. If it is accessible from outside the Kubernetes cluster then an attacker can use the curl command or any other similar utility to exploit the vulnerability. Otherwise an attacker must gain Command Execution in a Pod in the Kubernetes Cluster that contains the Kafka Cluster (in which there is the Pod that exposes the Kafka Connect Rest API)

## Details

In the Strimzi Project there is no authentication when connecting the Kafka Connect REST API, and there is no option to add authentication there. Other Utilities, like the MirrorMaker2 use a Kafka Connect REST API to create Connectors that specify how to Mirror the content of the topics between Kafka Clusters. 

The lack of authentication can lead to:

- Denial of Service for Mirroring

An attacker can create a simple script that constantly delete connectors (even when STRIMZI recreate them) by doing DELETE requests to the exposed API.

- Steal SASL Credentials

Imagine a kafka cluster "kafka_cluster1" that uses SASL PLAIN Authentication for brokers. This Kafka cluster is mirrored to another Kafka cluster elsewhere. 

An attacker can steal SASL credentials used for mirroring "kafka_cluster1" by:
      
      1. Getting a Connector Config from the API
      2. Create a new connector config file "evil-connector"
      3. Specify that "evil-connector" source mirroring IP (that previously was "kafka_cluster1") is the attacker compromised Pod
      4. POST evil-connector to the exposed API to effectively create the evil connector

When the connector is created, it will attempt to connect to the attacker compromised Pod, leaking the SASL PLAIN credentials to the attacker

- Topic Content Stealing

Similarly to the Stealing of SASL Credentials, but the attacker host his own Kafka cluster and create a mirroring via a connector.

- Potential RCE (remote code execution)

This happen when an old kafka version is installed with Strimzi. An attacker can combine the lack of authentication to perform the attack via https://hackerone.com/reports/1529790

## Side Notes

This issues is marked as enhancement in Strimzi Project: https://github.com/strimzi/strimzi-kafka-operator/issues/2161

## Recommended Protection

Some actions can protect against this and mitigate completely:  

- Adding Network Segmentation in Kubernetes to restrict access to the exposed API
- Use SASL-SCRAM to prevent SASL credential stealing
